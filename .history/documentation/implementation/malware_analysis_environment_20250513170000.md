# Malware Analysis Environment

This environment provides isolated, comprehensive facilities for static and dynamic malware analysis, leveraging specialized platforms and secure workflows.

---

## REMnux Analysis Platform

### System Configuration

- **Hardware Allocation:** 4 vCPUs, 8GB RAM, 100GB Storage
- **Operating System:** REMnux (latest release)
- **Static IP:** 10.2.20.2/24 (no gateway; DNS points internally)
- **User Account:**
  - Username: `remnux`
  - Password: `R3Mnux!M@lw@r3#An@lyst2025` (example only)

### Essential Analysis Components

- **Network Traffic Analysis:**
  - Wireshark
  - tcpdump
  - NetworkMiner
- **Internet Simulation:**
  - INetSim
    - service_bind_address: 10.2.20.2
    - dns_default_ip: 10.2.20.2
    - Fake HTTP, DNS, SMTP, FTP, etc., for malware detonation
- **Static Analysis Tools:**
  - radare2, YARA, pescan/peframe, oletools, strings/grep
- **Memory Forensics:**
  - Volatility, Rekall

### Analysis Directories

~/malware/
├── samples/ # Malware specimens
├── reports/ # Documentation/findings
├── tools/ # Custom scripts/utilities
└── extracted/ # Files extracted from malware

### Automation Scripts

- `~/bin/analyze.sh`: Quick triage
- `~/bin/yara-scan.sh`: Automated YARA scans
- `~/bin/capture-traffic.sh`: Network capture automation

---

## FlareVM Analysis Platform

### System Configuration

- **Hardware Allocation:** 4 vCPUs, 8GB RAM, 150GB Storage
- **Operating System:** Windows 10 Pro (security features disabled)
- **Static IP:** 10.2.20.3/24 (DNS → 10.2.20.2; no gateway)
- **User Account:**
  - Username: `flare`
  - Password: `Fl@r3VM!R3v3rs3#2025` (example only)

### Security Configurations

- Windows Defender, SmartScreen, Windows Updates disabled
- UAC notifications reduced

### Essential Tools

- **Dynamic Analysis:** Process Hacker, Process Monitor, API Monitor, Regshot
- **Debugging:** x64dbg/x32dbg, IDA Free, Ghidra, dnSpy
- **Network Analysis:** Wireshark, FakeNet-NG
- **Document Analysis:** PDF Stream Dumper, OfficeMalScanner

### Workflow Structure

- Dedicated drive (Z:) for samples
- Automated memory dumps
- Preconfigured analysis templates

---

## Network Isolation & Security

- **Segment:** 10.2.20.0/24 (isolated)
- **No default gateway:** Prevents external access
- **Firewall Rules:**
  - Malware network is completely blocked from internet/SOC
  - Only REMnux ↔ FlareVM allowed
  - SOC → Malware network only for secure file transfer

### Internet Simulation

- REMnux INetSim provides:
  - DNS (all domains → 10.2.20.2)
  - HTTP/HTTPS, SMTP, FTP, etc.

### Verification

- Test `ping 8.8.8.8` (should fail-no internet)
- Test internal connectivity: `ping 10.2.20.3` from REMnux
- Test INetSim response: HTTP request to any domain should receive simulated content

---

## Secure File Transfer Mechanism

- **Host shared folder:** `/mnt/CySec Lab/Malware Samples` (noexec, nosuid, nodev)
- **Access Control:** Restricted to security group; audit logging enabled
- **VM Integration:**
  - REMnux: `/media/malware_samples`
  - FlareVM: Z: mapped as `\\VBOXSVR\Malware_Samples`
- **Workflow:**
  - Acquire sample → initial scan → transfer to shared folder → copy to VM → local analysis → documentation → post-analysis cleanup

---

## Malware Analysis Workflow

**Pre-Analysis:**

- Snapshot VM
- Verify isolation
- Start packet capture
- Prep documentation

**Static Analysis:**

- Hash file (MD5, SHA1, SHA256)
- Extract strings
- Inspect PE headers/sections
- Scan with YARA
- Review embedded resources

**Dynamic Analysis:**

- Execute in controlled environment
- Monitor process, registry, FS changes
- Capture network traffic
- Identify persistence methods

**Post-Analysis:**

- Document findings, extract IOCs
- Revert VM, archive samples/reports

**Cross-Platform Techniques:**

- REMnux: Triage/static analysis
- FlareVM: Dynamic analysis/debugging
- Both: Network/traffic analysis

---

_The isolated Malware Analysis Environment enables safe, repeatable workflows for understanding and detecting malicious code._
